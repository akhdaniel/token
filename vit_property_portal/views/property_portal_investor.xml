<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_asset_overview" name="Ikhtisar Aset (Modern)">
        <t t-call="portal.portal_layout">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h4 class="fw-bold mb-1">Ikhtisar Aset</h4>
                        <p class="text-muted mb-0">
                            Ringkasan portofolio investasi properti Anda
                        </p>
                    </div>
                    <a href="/properties" class="btn btn-outline-primary px-4">
                        <i class="fa fa-plus me-2"></i>Tambah Investasi
                    </a>
                </div>
                <hr/>

                <div class="row g-4">
                    <div class="col-lg-4 col-md-6">
                        <div class="card h-100 rounded-4">
                            <div class="card-body p-4 d-flex flex-column justify-content-between">
                                <div>
                                    <p class="text-primary text-uppercase small mb-2">Saldo Saya</p>
                                    <h3 class="fw-bold text-success mb-0">
                                        <t t-esc="user_balance_currency or 0" t-options="{'widget': 'monetary', 'display_currency': user.currency_id}"/>
                                    </h3>
                                </div>
                                <!-- Tombol Tarik Dana -->
                                <button class="btn btn-success w-100 mt-4 py-2"
                                        data-bs-toggle="modal"
                                        data-bs-target="#withdrawModal">
                                    Tarik Dana
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6">
                        <div class="card h-100 rounded-4">
                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="text-muted">Nilai Akun Saat Ini</span>
                                    <span class="fw-bold text-success">
                                        <t t-esc="current_account_value or 0" t-options="{'widget': 'monetary', 'display_currency': user.currency_id}"/>
                                    </span>
                                </div>
                                <hr class="my-3"/>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Investasi Awal</span>
                                    <span class="fw-semibold text-dark">
                                        <t t-esc="investasi_awal or 0" t-options="{'widget': 'monetary', 'display_currency': user.currency_id}"/>
                                    </span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Total Sewa Diperoleh</span>
                                    <span class="fw-semibold text-dark">
                                        <t t-esc="total_rent_income or 0" t-options="{'widget': 'monetary', 'display_currency': user.currency_id}"/>
                                    </span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Token</span>
                                    <span class="fw-semibold text-dark">
                                        <t t-esc="token_awal or 0" /> + <t t-esc="token_count or 0" />
                                    </span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Properti Dimiliki</span>
                                    <span class="fw-semibold text-dark">
                                        <t t-esc="owned_property_count or 0"/>
                                    </span>
                                </div>
                                <a href="/investor/nilai_akun" class="btn btn-outline-info w-100 mt-3 py-2">
                                    Lihat Detail
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-12">
                        <div class="card h-100 rounded-4 bg-light">
                            <div class="card-body p-4 d-flex flex-column justify-content-center text-center">
                                <h5 class="fw-bold mb-3 text-primary">Optimalkan Portofolio Anda</h5>
                                <p class="text-muted mb-4">
                                    Diversifikasi investasi untuk pertumbuhan jangka panjang dan risiko minimal.
                                </p>
                                <a href="/properties" class="btn btn-outline-primary px-4">
                                    Lihat Rekomendasi
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== Modal Penarikan Dana ===== -->
            <div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 border-0 shadow">
                        <div class="modal-header border-0">
                            <h5 class="modal-title fw-bold text-success" id="withdrawModalLabel">Form Penarikan Dana</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="withdrawForm" t-att-action="'/portal/withdraw_request'" method="post">
                                <div class="mb-3">
                                    <label for="token_amount" class="form-label fw-semibold">Jumlah Token</label>
                                    <input type="number" min="1" step="1" name="token_amount"
                                           id="token_amount" class="form-control rounded-3"
                                           placeholder="Masukkan jumlah token" required="True"/>
                                </div>
                                <div class="mb-3">
                                    <label for="bank_account" class="form-label fw-semibold">Rekening Bank Tujuan</label>
                                    <select class="form-select rounded-3" name="bank_account" id="bank_account" required="True">
                                        <option value="">Pilih Rekening Bank</option>
                                        <t t-foreach="user.partner_id.bank_ids" t-as="b">
                                            <option t-att-value="b.id">
                                                <t t-esc="b.bank_name"/> - <t t-esc="b.acc_number"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success btn-lg rounded-3">
                                        Ajukan Penarikan
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer border-0 text-muted text-center small">
                            Proses penarikan memerlukan verifikasi dan mungkin memakan waktu 1â€“2 hari kerja.
                        </div>
                    </div>
                </div>
            </div>
            <!-- ===== End Modal ===== -->
        </t>
    </template>

    <template id="nilai_akun_table" name="Tabel Nilai Akun">
        <t t-call="portal.portal_layout">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <span class="fw-bold">Detail Nilai Akun</span>
                            </div>
                            <div class="card-body">
                                <table class="table table-striped table-hover table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="text-center">Property</th>
                                            <th class="text-center">Transaksi</th>
                                            <th class="text-center">Token Awal</th>
                                            <th class="text-center">Jumlah Investasi</th>
                                            <th class="text-center">Profit</th>
                                            <th class="text-center">Token Profit</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="rows" t-as="r">
                                            <tr>
                                                <td><t t-esc="r['property_name']"/></td>
                                                <td><t t-esc="r['transaksi']"/></td>
                                                <td class="text-center"><t t-esc="r['token']"/></td>
                                                <td class="text-end">
                                                <t t-esc="r['jumlah_investasi']"
                                                    t-options="{'widget': 'monetary', 'display_currency': currency}"/>
                                                </td>
                                                <td class="text-end">
                                                <t t-esc="r['profit']"
                                                    t-options="{'widget': 'monetary', 'display_currency': currency}"/>
                                                </td>
                                                <td class="text-center"><t t-esc="r['token_profit']"/></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>

                                <!-- Ringkasan / Summary -->
                                <hr/>
                                <div class="card bg-light border-0">
                                    <div class="card-body">
                                        <h6 class="fw-bold mb-3">Summary</h6>
                                        <div class="row text-center">
                                            <div class="col-md-3 col-6 mb-2">
                                                <div class="fw-semibold">Total Token Awal</div>
                                                <div class="fw-bold">
                                                    <t t-esc="summary['total_token']"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-6 mb-2">
                                                <div class="fw-semibold">Total Investasi</div>
                                                <div class="fw-bold">
                                                    <t t-esc="summary['total_investasi']"
                                                    t-options="{'widget': 'monetary', 'display_currency': currency}"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-6 mb-2">
                                                <div class="fw-semibold">Total Profit</div>
                                                <div class="fw-bold text-success">
                                                    <t t-esc="summary['total_profit']"
                                                    t-options="{'widget': 'monetary', 'display_currency': currency}"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-6 mb-2">
                                                <div class="fw-semibold">Total Token Profit</div>
                                                <div class="fw-bold">
                                                    <t t-esc="summary['total_token_profit']"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- End Ringkasan -->

                                <!-- Tambahan Total Saldo -->
                                <hr class="my-3"/>
                                <div class="text-center">
                                    <h5 class="fw-bold mb-1">Total Saldo</h5>
                                    <h4 class="fw-bold text-success">
                                        <t t-esc="summary['total_saldo']"
                                        t-options="{'widget': 'monetary', 'display_currency': currency}"/>
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
