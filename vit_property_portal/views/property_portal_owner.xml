<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="property_portal_owner" inherit_id="portal.portal_my_home">
		<xpath expr="//div[@id='portal_client_category']" position="inside">
			<t t-call="portal.portal_docs_entry" t-if="False"/>
            <t t-if="request.env.user.partner_id.is_owner">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="icon" t-value="'/vit_property_portal/static/src/img/property.svg'"/>
                    <t t-set="title">Property</t>
                    <t t-set="text">Configure your property</t>
                    <t t-set="url" t-value="'/owner/properties'"/>
                    <t t-set="config_card" t-value="True"/>
                </t>
            </t>
		</xpath>

		<xpath expr="//div[@id='portal_client_category']" position="inside">
			<t t-call="portal.portal_docs_entry" t-if="False"/>
            <t t-if="request.env.user.partner_id.is_investor">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="icon" t-value="'/vit_property_portal/static/src/img/invest.svg'"/>
                    <t t-set="title">Portfolio</t>
                    <t t-set="text">See your portfolio</t>
                    <t t-set="url" t-value="'/investor/ikhtisar'"/>
                    <t t-set="config_card" t-value="True"/>
                </t>
            </t>
		</xpath>
	</template>

    <template id="property_portal_property_list" name="My Properties">
        <t t-call="portal.portal_layout">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <span class="fw-bold">Properties</span>
                            </div>
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between mb-3">
                                    <a href="/owner/property/new" class="btn btn-primary d-print-none">
                                        Add New Property
                                    </a>
                                </div>
                                
                                <t t-if="not property_units">
                                    <div class="alert alert-info" role="alert">
                                        You have not added any properties yet.
                                    </div>
                                </t>
                                
                                <t t-if="property_units">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-bordered">
                                            <thead class="bg-light">
                                                <tr>
                                                    <th class="text-center" scope="col">Property</th>
                                                    <th class="text-center" scope="col">Type</th>
                                                    <th class="text-center" scope="col">Total Token</th>
                                                    <th class="text-center" scope="col">Available Token</th>
                                                    <th class="text-center" scope="col">Status</th>
                                                    <th class="text-center" scope="col">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="property_units" t-as="property_unit">
                                                    <tr>
                                                        <td><a t-attf-href="/my/property/#{property_unit.id}" t-esc="property_unit.name"/></td>
                                                        <td><span t-esc="property_unit.property_type"/></td>
                                                        <td><span t-esc="property_unit.total_tokens"/></td>
                                                        <td><span t-esc="property_unit.available_tokens"/></td>
                                                        <td>
                                                            <span t-if="property_unit.is_sale" class="badge bg-success me-1">For Sale</span>
                                                            <span t-if="property_unit.is_rent" class="badge bg-info">For Rent</span>
                                                        </td>
                                                        <td>
                                                            <a t-attf-href="/my/property/#{property_unit.id}" class="btn btn-warning btn-sm me-1" title="Edit">
                                                                <i class="fa fa-pencil"/>
                                                            </a>
                                                            <form t-attf-action="/my/property/delete/#{property_unit.id}" method="post" class="d-inline">
                                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                                <button type="submit" class="btn btn-danger btn-sm" title="Delete" onclick="return confirm('Are you sure you want to delete this property?');">
                                                                    <i class="fa fa-trash"/>
                                                                </button>
                                                            </form>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="portal_my_property_unit_form" name="Property Unit Form">
        <t t-call="portal.portal_layout">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col">
                        <!-- Card Form -->
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <t t-if="property_unit"><span class="fw-bold">Edit Property</span></t>
                                <t t-else=""><span class="fw-bold">Add New Property</span></t>
                            </div>
                            <div class="card-body p-5">
                                <form action="javascript:void(0)" id="property-form">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <input type="hidden" name="id" t-att-value="property_unit and property_unit.id or ''"/>
                                    
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-6">
                                            <label for="name" class="form-label fw-medium">Property Name</label>
                                            <input type="text" id="name" name="name"
                                                class="form-control"
                                                t-att-value="property_unit and property_unit.name or ''"
                                                required="True"/>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="property_type" class="form-label fw-medium">Property Type</label>
                                            <select id="property_type" name="property_type"
                                                class="form-select"
                                                required="True">
                                                <option t-att-selected="not property_unit" value="">-- Select Type --</option>
                                                <option value="villa" t-att-selected="property_unit and property_unit.property_type == 'villa'">Villa</option>
                                                <option value="apartemen" t-att-selected="property_unit and property_unit.property_type == 'apartemen'">Apartment</option>
                                                <option value="house" t-att-selected="property_unit and property_unit.property_type == 'house'">House</option>
                                                <option value="office" t-att-selected="property_unit and property_unit.property_type == 'office'">Office</option>
                                                <option value="warehouse" t-att-selected="property_unit and property_unit.property_type == 'warehouse'">Warehouse</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label class="form-label fw-medium d-block mb-2">Listing Type</label>
                                            <div class="form-check form-switch mb-2">
                                                <input type="checkbox" id="is_sale" name="is_sale"
                                                    class="form-check-input sale-rent-switch"
                                                    t-att-checked="property_unit and property_unit.is_sale"/>
                                                <label class="form-check-label fw-medium" for="is_sale">Is For Sale</label>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input type="checkbox" id="is_rent" name="is_rent"
                                                    class="form-check-input sale-rent-switch"
                                                    t-att-checked="property_unit and property_unit.is_rent"/>
                                                <label class="form-check-label fw-medium" for="is_rent">Is For Rent</label>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div id="sale_price_group" t-attf-style="display: #{property_unit and property_unit.is_sale and 'block' or 'none'};" class="mt-3">
                                                <label for="sale_price" class="form-label fw-medium">Sale Price</label>
                                                <input type="text" id="sale_price_display"
                                                    class="form-control currency-input"
                                                    t-att-value="property_unit and property_unit.sale_price or ''"/>
                                                <input type="hidden" name="sale_price" id="sale_price"/>

                                                <label for="sale_price_target" class="form-label fw-medium mt-2">Sale Price Target</label>
                                                <input type="text" id="sale_price_target_display" class="form-control currency-input"
                                                    t-att-value="property_unit and property_unit.sale_price_target or ''"/>
                                                <input type="hidden" name="sale_price_target" id="sale_price_target"/>
                                            </div>

                                            <div id="rental_price_group" t-attf-style="display: #{property_unit and property_unit.is_rent and 'block' or 'none'};" class="mt-3">
                                                <label for="rental_price" class="form-label fw-medium">Rental Price</label>
                                                <input type="text" id="rental_price_display"
                                                    class="form-control currency-input"
                                                    t-att-value="property_unit and property_unit.rental_price or ''"/>
                                                <input type="hidden" name="rental_price" id="rental_price"/>

                                                <label for="rent_type_id" class="form-label fw-medium mt-2">Rental Type</label>
                                                <select name="rent_type_id" class="form-control">
                                                    <option value="">-- Select Rental Type --</option>
                                                    <t t-foreach="rent_types" t-as="rt">
                                                        <option t-att-value="rt.id" t-att-selected="property_unit and property_unit.rent_type_id">
                                                            <t t-esc="rt.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-6">
                                            <label for="total_tokens" class="form-label fw-medium">Total Token</label>
                                            <input type="text" id="total_tokens" name="total_tokens"
                                                class="form-control"
                                                t-att-value="property_unit and property_unit.total_tokens or ''"
                                                required="True"/>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="available_tokens" class="form-label fw-medium">Available Token</label>
                                            <input type="text" id="available_tokens" name="available_tokens"
                                                class="form-control"
                                                t-att-value="property_unit and property_unit.available_tokens or ''" readonly="True"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-6">
                                            <label for="cost_price" class="form-label fw-medium">Cost Price</label>
                                            <input type="text" id="cost_price_display" name="cost_price"
                                                class="form-control currency-input"
                                                t-att-value="property_unit and property_unit.cost_price or ''"/>
                                            <input type="hidden" name="cost_price" id="cost_price" 
                                                t-att-value="property_unit and property_unit.cost_price or ''"/>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="price_per_token" class="form-label fw-medium">Price Per Token</label>
                                            <input type="text" id="price_per_token_display" class="form-control currency-input"
                                                t-att-value="property_unit and property_unit.price_per_token or ''" readonly="True"/>
                                            <input type="hidden" name="price_per_token" id="price_per_token"
                                                t-att-value="property_unit and property_unit.price_per_token or ''"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-6">
                                            <label for="expected_rental_yield" class="form-label fw-medium">Expected Rental Yield</label>
                                            <input type="text" id="expected_rental_yield" name="expected_rental_yield"
                                                class="form-control"
                                                t-att-value="property_unit and property_unit.expected_rental_yield or ''"/>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="address" class="form-label fw-medium">Full Address</label>
                                        <textarea id="address" name="address"
                                            class="form-control"
                                            rows="3"
                                            required="True"><t t-esc="property_unit and property_unit.address or ''"/></textarea>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="description" class="form-label fw-medium">Property Description</label>
                                        <textarea id="description" name="description"
                                            class="form-control"
                                            rows="5"><t t-esc="property_unit and property_unit.description or ''"/></textarea>
                                    </div>
                                    
                                    <div class="text-end">
                                        <a href="/my/properties" class="btn btn-outline-dark me-2">Cancel</a>
                                        <button type="submit" class="btn btn-primary px-4" id="save-btn">
                                            Save Property
                                            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                        </button>
                                    </div>
                                </form>
                                
                                <div id="alert-container" class="mt-3"></div>
                                <hr />

                                <div id="property-tabs">
                                    <ul class="nav nav-tabs mt-3 px-4" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <a href="#" class="nav-link active" id="token-tab" data-bs-toggle="tab"
                                                    data-bs-target="#token-pane" role="tab"
                                                    aria-controls="token-pane" aria-selected="true">
                                                Token
                                            </a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a href="#" class="nav-link" id="image-tab" data-bs-toggle="tab"
                                                    data-bs-target="#image-pane" role="tab"
                                                    aria-controls="image-pane" aria-selected="false">
                                                Image
                                            </a>
                                        </li>
                                    </ul>
                                    <div class="tab-content">
                                        <div class="tab-pane fade show active" id="token-pane" role="tabpanel" aria-labelledby="token-tab">
                                            <t t-if="property_unit and property_unit.id">
                                                <t t-call="vit_property_portal.portal_my_property_list_token">
                                                    <t t-set="tokens_page" t-value="tokens_page"/>
                                                    <t t-set="property_unit" t-value="property_unit"/>
                                                    <t t-set="page" t-value="page"/>
                                                    <t t-set="page_size" t-value="page_size"/>
                                                    <t t-set="page_count" t-value="page_count"/>
                                                </t>
                                            </t>
                                        </div>
                                        <div class="tab-pane fade" id="image-pane" role="tabpanel" aria-labelledby="image-tab">
                                            <div class="d-flex justify-content-start align-items-start mt-3 mb-3">
                                                <button type="button" class="btn btn-primary" id="btn-add-image">
                                                    <i class="fa fa-upload me-1"></i> Upload Image
                                                </button>
                                            </div>
                                            <!-- Alert container -->
                                            <div id="image-alert-container"></div>
                                            <!-- Table List -->
                                            <table class="table table-bordered table-hover" id="image-table">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th class="text-center">Sequence</th>
                                                        <th class="text-center">Preview</th>
                                                        <th class="text-center">Name</th>
                                                        <th class="text-center">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-if="property_unit and property_unit.property_unit_image_ids">
                                                        <t t-foreach="property_unit and property_unit.property_unit_image_ids or []" t-as="img">
                                                            <tr t-att-data-id="img.id" t-att-data-image="'/web/image/vit.property_unit_image/' + str(img.id) + '/image'">
                                                                <td><t t-esc="img.sequence"/></td>
                                                                <td>
                                                                    <img t-att-src="'/web/image/vit.property_unit_image/' + str(img.id) + '/image'" alt="image" style="height:60px;"/>
                                                                </td>
                                                                <td><t t-esc="img.name"/></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-warning btn-edit" id="btn-edit">Edit</button>
                                                                    <button class="btn btn-sm btn-danger btn-delete" id="btn-delete">Delete</button>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                    </t>
                                                    <t t-else="">
                                                        <tr>
                                                            <td colspan="4" class="text-center text-muted">
                                                                Belum ada image
                                                            </td>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                            <!-- Modal Upload -->
                                            <div class="modal fade" id="uploadImageModal" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Upload Image</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="upload-image-form">
                                                                <input type="hidden" name="property_unit_id" t-att-value="property_unit and property_unit.id"/>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Sequence</label>
                                                                    <input type="number" name="sequence" class="form-control" value="1" required="True"/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Select Image</label>
                                                                    <input type="file" name="image" accept="image/*" class="form-control" required="True"/>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary w-100">
                                                                    Upload
                                                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Modal Edit -->
                                            <div class="modal fade" id="editImageModal" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Edit Image</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="edit-image-form">
                                                                <input type="hidden" name="image_id"/>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Name</label>
                                                                    <input type="text" name="name" class="form-control" required="True"/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Sequence</label>
                                                                    <input type="number" name="sequence" class="form-control" required="True"/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <img id="edit-image-preview" src="" class="img-fluid rounded border" style="max-height:200px;"/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Change Image</label>
                                                                    <input type="file" name="image" accept="image/*" class="form-control"/>
                                                                </div>
                                                                <button type="submit" class="btn btn-primary w-100">Update</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>